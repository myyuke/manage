<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8"/>
	<meta name="renderer" content="webkit|ie-comp|ie-stand"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="lib/html5shiv.js"></script>
	<script type="text/javascript" src="lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="../static/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<title>用户管理</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 用户中心 <span class="c-gray en">&gt;</span> 用户管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>

<div id="app">
	<div class="cl pd-5 bg-1 bk-gray">
		<span class="l">
			<a class="btn btn-primary size-S radius" href="javascript:;" v-on:click="v_member_add" ><i class="Hui-iconfont">&#xe600;</i> 新增</a>
			<a class="btn btn-danger size-S radius" href="javascript:;" v-on:click="v_member_del_mang" ><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>
		</span>

		<span class="r">
 			<a class="btn btn-success size-s radius " href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i>刷新</a>
		</span>
	</div>
	<div class="text-l pd-5" >
		人员姓名：<input type="text" class="input-text size-S" style="width:150px" placeholder="请输入人员姓名" id="personName" name="title"/>
		<button  type="button" class="btn btn-success size-S radius" v-on:click="v_member_findByname"><i class="Hui-iconfont">&#xe665;</i> 查询</button>
	</div>
	<table class="table table-border table-bordered table-hover table-bg table-sort">
		<thead>
		<tr class="text-c">
			<th width="25"><input type="checkbox" name="" value="" /></th>
			<th width="100">姓名</th>
			<th width="100">年龄</th>
			<th width="100">职位</th>
			<th width="100">操作</th>
		</tr>
		</thead>
		<tbody>
		<tr class="text-c" v-for="item in pageData">
			<td>
				<input type="checkbox" id="check" name="ids" :value="item.personId"/>
				<label for="check">{{ item.personId }}</label>
			</td>
			<td>{{ item.personName }}</td>
			<td>{{ item.personAge }}</td>
			<td>
				<span v-for="seat in item.position">&nbsp{{ seat.positionName }}&nbsp</span>
			</td>
			<td class="td-manage">
				<a title="编辑" href="javascript:;" v-on:click="edit(item.personId)" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a>
				<a title="删除" href="javascript:;" v-on:click="v_member_del(item.personId)" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
			</td>
		</tr>
		</tbody>
	</table>
	<!--<div v-show="pageData.total > 0" class="laypage_main laypageskin_default" style="margin-top: 10px">-->
		<!--<div class="l">-->
				<!--<span>每页 <select name="pageSizeSelect" id="pageSizeSelect" style="vertical-align: baseline!important; height: 27.6px;" onchange="query()">-->
						<!--<option value="10" selected="selected">10</option>-->
						<!--<option value="25">25</option>-->
						<!--<option value="50">50</option>-->
						<!--<option value="100">100</option>-->
				<!--</select> 条-->
				 <!--显示 {{pageData.rowIndexStart}} 到 {{pageData.rowIndexEnd}} ，共 {{pageData.total}} 条</span>-->
		<!--</div>-->
		<!--<div id="pageNav" class="r"></div>-->

	<!--</div>-->
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript">
    var app = new Vue({
        el: '#app',
        data: {
            pageData: {}
        },
        mounted:function(){
            this.$nextTick(function () {
                this.getList()
            });
        },
        methods:{
            /*用户-列表*/
            getList: function() {
                $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: '/persons',
                    data:{
                        access_token:"888888"
                    },
                    success: function(data){
                        app.pageData = data;
                    },
                    error:function(data) {
                        console.log("请求错误");
                    },
                    timeout:3000000
                });
            },

            /*用户-添加*/
            v_member_add:function () {
                layer_show('添加用户','/add','','510');
            },
            /*用户-删除*/
            v_member_del: function (id) {
                layer.confirm('确认要删除吗？',function(index){
                    $.ajax({
                        type: 'DELETE',
                        url: '/delperson?id='+id+'&&access_token=888888',
                        dataType: 'json',
                        data:{
                        },
                        success: function(data){
                            layer.msg('已删除!',{icon:1,time:1000});
                            app.getList();
                        },
                        error:function(data) {
                            console.log(data.msg);
                        },
                    });
                });
            },
            /**
             * 批量删除
             */
            v_member_del_mang: function (){
                var selectdItems = $(":checkbox[name=ids]:checked");
                if (selectdItems.size() == 0) {
                    layer.alert("请选择要删除的记录！");
                    return;
                }
                var ids = [];
                selectdItems.each(function() {
                    ids.push($(this).val());
                });
                    layer.confirm('确认要删除吗？', function() {
                        var tipIndex = null;
                        $.ajax({
                            type : "POST",
                            url : '/delpersons',
                            contentType:'application/json; charset=utf-8',
                            data : JSON.stringify({
                                ids:ids,
								token:"888888"
                            }),
                            beforeSend : function() {
                                tipIndex = layer.load(0, {
                                    shade : false
                                });
                            },
                            complete : function() {
                                layer.close(tipIndex);
                            },
                            error : function(request) {
                                layer.alert("系统出错");
                            },
                            success : function(data) {
                                layer.msg('已删除!',{icon:1,time:1000});
                                app.getList();
                            }
                        });
                    });
            },
            /*用户-编辑*/
            v_member_edit:function (personId) {
                layer_show('修改用户','/edit?personId='+personId,'','510');
            },
			v_member_findByname:function () {
                var personName = $("#personName").val();
                $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: '/personsOneLike',
                    data:{
                        personName:personName,
                        access_token:"888888"
                    },
                    success: function(data){
                        app.pageData = data;
                    },
                    error:function(data) {
                        console.log("请求错误");
                    },
                    timeout:3000000
                });
            }

        }
    });
    function edit(id){
        layer_show('修改用户','/edit?personId='+id,'','510');
    }
    //    function query(pageNo, pageSize) {
    //        if (!pageNo) {
    //            pageNo = 1;
    //        }
    //        if (!pageSize) {
    //            pageSize =  $("#pageSizeSelect").val();
    //        }
    //        var tip = layer.load(0, {shade: false});
    //        $.ajax({
    //            type: "GET",
    //            url:'http://188.226.138.32:8081/persons?access_token=888888',
    //            beforeSend: function () {
    //            },
    //            complete: function () {
    //                layer.close(tip);
    //            },
    //            error: function(request) {
    //                layer.alert("系统错误");
    //            },
    //            success: function(result) {
    //                    app.pageData = result.data;
    //            }
    //        });
    //    }
</script>
</body>
</html>

